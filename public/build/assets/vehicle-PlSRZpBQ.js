var m=document.getElementById("divLoading");document.addEventListener("DOMContentLoaded",function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$("#vehicleForm").on("submit",function(t){t.preventDefault(),m.style.display="flex";const a=$(this).attr("data-id");let n="",s="";const r=new FormData(this);a?(n="/admin/vehicles/"+a,s="POST",r.append("_method","PUT")):(n=window.routes.storeVehicle,s="POST"),$.ajax({url:n,type:s,data:r,processData:!1,contentType:!1,success:function(i){m.style.display="none",$("#vehicleModal").modal("hide"),u.ajax.reload(null,!1),Swal.fire({title:i.message,icon:"success",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:o=>{o.addEventListener("mouseenter",Swal.stopTimer),o.addEventListener("mouseleave",Swal.resumeTimer)}})},error:function(i){if(m.style.display="none",i.status===422){const o=i.responseJSON.errors;let l="<ul>";$.each(o,function(h,d){l+=`<li>${d[0]}</li>`}),l+="</ul>",$("#error-messages").removeClass("d-none").html(l)}}})}),$(document).on("click",".viewVehicle",function(){const t=$(this).attr("data-vehicle"),e=JSON.parse(t);$("#plate1").text(e.plate),$("#brand1").text(e.brand_name),$("#model1").text(e.model),$("#type1").text(e.type_name),$("#color1").text(e.color),$("#year1").text(e.year),$("#engine_number1").text(e.engine_number),$("#chassis_number1").text(e.chassis_number),$("#description1").html(e.description);const s=e.image_patch&&/\.(jpg|jpeg|png|gif|webp)$/i.test(e.image_patch)?e.image_patch:"https://thumb.ac-illust.com/b1/b170870007dfa419295d949814474ab2_t.jpeg";$("#imgPreview1").attr("src",s),$("#status1").html(e.status),$("#vehicleModalView").modal("show")}),$(document).on("click",".editVehicle",function(){const t=$(this).data("id"),e=$(this).data("plate"),a=$(this).data("model"),n=$(this).data("type_id"),s=$(this).data("brand_id"),r=$(this).data("year"),i=$(this).data("color"),o=$(this).data("engine_number"),l=$(this).data("chassis_number"),h=$(this).data("description"),d=$(this).data("status"),c=$(this).data("image_patch"),p=c&&/\.(jpg|jpeg|png|gif|webp)$/i.test(c)?c:"https://thumb.ac-illust.com/b1/b170870007dfa419295d949814474ab2_t.jpeg";$("#vehicleForm").attr("data-id",t),$("#plate").val(e),$("#model").val(a),$('select[name="type_id"]').val(n),$('select[name="brand_id"]').val(s),$("#color").val(i),$("#year").val(r),$("#engine_number").val(o),$("#chassis_number").val(l),$("#description").val(h),$('select[name="status"]').val(d),$("#imgPreview").attr("src",p),$("#exampleModalLabel").text("Editar Vehículo"),$("#vehicleModal").modal("show")}),$("#vehicleModal").on("hidden.bs.modal",function(){const t=$("#vehicleForm");t[0].reset(),t.removeAttr("data-id"),$("#exampleModalLabel").text("Nuevo Vehículo"),$("#error-messages").addClass("d-none").empty(),$("#imgPreview").attr("src","https://thumb.ac-illust.com/b1/b170870007dfa419295d949814474ab2_t.jpeg"),$("#image").val("")}),$("#vehicleModal").on("shown.bs.modal",function(){$(this).find(".select2bs4").each(function(){$(this).hasClass("select2-hidden-accessible")&&$(this).select2("destroy"),$(this).select2({theme:"bootstrap4",dropdownParent:$("#vehicleModal")})})})});let u;$(document).ready(function(){u=$("#tableVehicle").DataTable({processing:!0,serverSide:!0,ajax:window.routes.vehiclesList,columns:[{data:"DT_RowIndex",name:"DT_RowIndex"},{data:"id",name:"id"},{data:"plate",name:"plate"},{data:"model",name:"model"},{data:"type_name",name:"type_name"},{data:"brand_name",name:"brand_name"},{data:"color",name:"color"},{data:"year",name:"year"},{data:"status",name:"status",orderable:!1,searchable:!1},{data:"acciones",name:"acciones",orderable:!1,searchable:!1}],responsive:!0})});$(document).on("click",".deleteVehicle",function(){const t=$(this).data("id");Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&$.ajax({url:`${window.routes.deleteVehicle}/${t}`,type:"DELETE",success:function(a){u.ajax.reload(null,!1),Swal.fire({icon:"success",title:a.message,toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})},error:function(){Swal.fire("Error","Ocurrió un error al eliminar el Tipo","error")}})})});
