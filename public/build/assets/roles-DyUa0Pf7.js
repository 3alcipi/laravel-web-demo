var l=document.querySelector("#divLoading");document.addEventListener("DOMContentLoaded",function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$("#roleForm").on("submit",function(e){e.preventDefault(),l.style.display="flex";const t=$(this),o=t.attr("data-id");let a="",r="";o?(a="/admin/roles/"+o,r="PUT"):(a=window.routes.storeRole,r="POST");const c=t.serialize();$.ajax({url:a,type:r,data:c,success:function(n){l.style.display="none",$("#roleModal").modal("hide"),d.ajax.reload(null,!1),Swal.fire({title:n.message,icon:"success",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:s=>{s.addEventListener("mouseenter",Swal.stopTimer),s.addEventListener("mouseleave",Swal.resumeTimer)}})},error:function(n){if(l.style.display="none",n.status===422){const s=n.responseJSON.errors;let i="<ul>";$.each(s,function(m,u){i+=`<li>${u[0]}</li>`}),i+="</ul>",$("#error-messages").removeClass("d-none").html(i)}}})}),$(document).on("click",".editRole",function(){const e=$(this).data("id"),t=$(this).data("name");$("#roleForm").attr("data-id",e),$("#name").val(t),$("#exampleModalLabel").text("Editar Rol"),$('input[name="permissions[]"]').prop("checked",!1),$.ajax({url:`/admin/roles/${e}/permissions`,method:"GET",success:function(o){console.log("Permisos asignados:",o),o.forEach(function(a){$(`input[name="permissions[]"][value="${a}"]`).prop("checked",!0)})},complete:function(){$("#roleModal").modal("show")}})}),$("#roleModal").on("hidden.bs.modal",function(){const e=$("#roleForm");e[0].reset(),e.removeAttr("data-id"),$("#exampleModalLabel").text("Nuevo Rol"),$("#error-messages").addClass("d-none").empty()})});let d;$(document).ready(function(){d=$("#tableRole").DataTable({processing:!0,serverSide:!0,ajax:window.routes.rolesList,columns:[{data:"DT_RowIndex",name:"DT_RowIndex"},{data:"id",name:"id"},{data:"name",name:"name"},{data:"guard_name",name:"guard_name"},{data:"acciones",name:"acciones",orderable:!1,searchable:!1}],responsive:!0})});$(document).on("click",".deleteRole",function(){const e=$(this).data("id");Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&$.ajax({url:`${window.routes.deleteRole}/${e}`,type:"DELETE",success:function(o){d.ajax.reload(null,!1),Swal.fire({icon:"success",title:o.message,toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})},error:function(){Swal.fire("Error","No se puede eliminar este rol porque está asignado a uno o más usuarios.","error")}})})});
